# n8n Workflow Toolbox

This toolbox provides utilities for generating and managing n8n workflows, particularly for Notion database integrations.

## Scripts

### n8n-workflow-starter.sh

Generates starter n8n workflows with webhook triggers and Notion field mapping based on database schemas.

**Usage:**
```bash
./.claude/toolbox-n8n/n8n-workflow-starter.sh "<notion_database_name>"
```

**Examples:**
```bash
# Generate starter workflow for research database
./.claude/toolbox-n8n/n8n-workflow-starter.sh "MGDB.Helix.Research"

# Generate starter workflow for applicant screening
./.claude/toolbox-n8n/n8n-workflow-starter.sh "Jobs.QA.Applicants"
```

**Requirements:**
- Notion database schema must exist in context directory (generated by `notion-context-save.sh`)
- Must be run from workflow branch (detected via `n8n-900-workflow-dir-find.sh`)

**Generated Workflow Structure:**
1. **N00 Webhook Trigger** - Receives Notion webhook posts
2. **N01 Set Canonical Fields** - Maps webhook data to canonical variables  
3. **N02 Update Status** - Updates Notion page status to "n8n Done"

**Field Mapping:**
All Notion database fields are automatically mapped to canonical variables:

| Field Type | Webhook Path | Canonical Name |
|------------|--------------|----------------|
| rich_text | `body.data.properties.{Field}.rich_text[0].plain_text` | `notion_{field}` |
| title | `body.data.properties.{Field}.title[0].plain_text` | `notion_{field}` |
| url | `body.data.properties.{Field}.url` | `notion_{field}` |
| status | `body.data.properties.{Field}.status.name` | `notion_{field}` |
| date | `body.data.properties.{Field}.date` | `notion_{field}` |

**Special Fields:**
- `notion_page_id` - Notion page ID from `body.data.id`
- `notion_database_id` - Database ID from `body.data.parent.database_id`

**Output:**
- File: `lifecycle/{timestamp}-STARTER-04-workflow.json`
- Format: Valid n8n workflow JSON ready for import
- Location: Current workflow directory

## Integration with Other Toolboxes

This toolbox works with:
- **toolbox-notion**: Use `notion-context-save.sh` to generate database schemas first
- **n8n agents**: Use n8n-100-workflow-extract and n8n-11-workflow-upload for iterative development

## Prerequisites

- Notion database schema files in context directory
- Valid n8n instance for import (optional)
- Proper workflow branch checkout